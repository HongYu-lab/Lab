<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>

    </style>
    <script>
        /*
        開始：滑鼠縮放的效果
        */
        function zoom(e) {
            //  1.取得一開始的 viewBox。
            let startViewBox = svg
                .getAttribute('viewBox')
                .split(' ')
                .map((n) => parseFloat(n));

            //  2.取得滑鼠執行縮放位置的 viewPort Client 座標，並利用 CTM 對應取得 SVG 座標。

            //  2.1 取得滑鼠執行縮放的位置
            let startClient = {
                x: e.clientX,
                y: e.clientY,
            };

            //  2.2 轉換成 SVG 座標系統中的 SVG 座標點
            let newSVGPoint = svg.createSVGPoint();
            let CTM = svg.getScreenCTM();
            newSVGPoint.x = startClient.x;
            newSVGPoint.y = startClient.y;
            let startSVGPoint = newSVGPoint.matrixTransform(CTM.inverse());

            //  3.進行縮放，如果要讓原本的尺寸縮放兩倍的話。
            //  3.1 設定縮放倍率
            let r;
            if (e.deltaY > 0) {
                r = 0.9;
            } else if (e.deltaY < 0) {
                r = 1.1;
            } else {
                r = 1;
            }
            //  3.2 進行縮放
            svg.setAttribute(
                'viewBox',
                `${startViewBox[0]} ${startViewBox[1]} ${startViewBox[2] * r} ${startViewBox[3] * r}`,
            );

            //  4.將一開始滑鼠的執行縮放位置的 viewPort Client 座標利用新的 CTM ，轉換出對應的 SVG 座標。
            CTM = svg.getScreenCTM();
            let moveToSVGPoint = newSVGPoint.matrixTransform(CTM.inverse());

            //  5.取得在縮放過程中該圓點的位移量 `(svgX0 - svgX1)`。
            let delta = {
                dx: startSVGPoint.x - moveToSVGPoint.x,
                dy: startSVGPoint.y - moveToSVGPoint.y,
            };

            //  6.設定最終的 viewBox2
            let middleViewBox = svg
                .getAttribute('viewBox')
                .split(' ')
                .map((n) => parseFloat(n));
            let moveBackViewBox = `${middleViewBox[0] + delta.dx} ${middleViewBox[1] + delta.dy} ${middleViewBox[2]
                } ${middleViewBox[3]}`;
            svg.setAttribute('viewBox', moveBackViewBox);

            //  更新 viewBox 資訊
            showViewBox();
        } //  結束：滑鼠縮放的效果

    </script>
</head>

<body>
    <script>svg.addEventListener('mousedown', mouseDown, false);
        svg.addEventListener('mousemove', drag, false);
        svg.addEventListener('mouseup', mouseUp, false);
    </script>

</body>

</html>